{% extends 'base.html' %}

{% load rest_framework %}
{% load template_extras %}
{% load humanize %}

{% block title %}League of Elo{% endblock %}

{% block content %}
<div class="content_grid">
<div class="section_div grid_item site_intro">
  <p>Welcome to the League of Elo! We run an Elo model across the 4 major regions of professional League of Legends play. Our model predicts the outcome of each match by assigning a probability to each team winning. These predictions drive and are are driven by the ratings the model maintains for each team.</p>
  <p>You can play along by creating an account and saving your own predictions for each match. You'll get points for each match you predict, with more points being awarded for better predictions. Check the <a href="{% url 'leaderboard' %}">Leaderboard</a> to compare your score with friends, strangers, and the titular Elo model itself! See the <a href="{% url 'about' %}">About page</a> for more info on how Score, AR, and other stats are calculated, as well as more info about how the model works.</p>
</div>

<div class="section_div grid_item match_lists">
  <h2 class="section_header">Upcoming Matches</h2>
  <table class="match_table" id="upcoming_match_table">
  </table>
</div>

<div class="section_div grid_item match_lists">
  <h2 class="section_header">Recent Matches</h2>
  <table class="match_table" id="recent_match_table">
  </table>
</div>

<div class="section_div grid_item team_ratings">
  <h2 class="section_header">Team Ratings</h2>
  {% team_ratings %}
</div>
</div>
{% endblock %}

{% block script %}
<script type="text/javascript">

function sort_ratings(column) {
  var ratings_tbody = $('.team_ratings_table > tbody');
  ratings_tbody.find('tr').sort(function (a, b) {
    var td_sel = 'td:nth('+column+')';
    var sort_action = 1 - 2*($(td_sel, b).text() > $(td_sel, a).text());
    if (column === 0) {
      sort_action *= -1;
    }
    return sort_action;
  }).appendTo(ratings_tbody);
}

$( document ).ready(function() {
  $.get('match_table', {
    'dataType': 'html',
    'regions': localStorage.getItem("regions"),
    'upcoming': 1,
  }).done(function (data) {
    $('#upcoming_match_table').html(data);
  }).fail(function (error) {
    console.log(error);
  });

  $.get('match_table', {
    'dataType': 'html',
    'regions': localStorage.getItem("regions"),
  }).done(function (data) {
    $('#recent_match_table').html(data);
  }).fail(function (error) {
    console.log(error);
  });
});

</script>
{% endblock %}
